// Code generated by impgen. DO NOT EDIT.

package zero_returns

import (
	"github.com/toejough/imptest/imptest"
	"testing"
)

type ProcessDataImp struct {
	*imptest.CallableController[struct{}]
	callable func(data string, count int)
}

func NewProcessDataImp(t testing.TB, callable func(data string, count int)) *ProcessDataImp {
	return &ProcessDataImp{
		CallableController: imptest.NewCallableController[struct{}](t),
		callable:           callable,
	}
}

func (s *ProcessDataImp) Start(data string, count int) *ProcessDataImp {
	go func() {
		defer func() {
			if r := recover(); r != nil {
				s.PanicChan <- r
			}
		}()

		s.callable(data, count)
		s.ReturnChan <- struct{}{}
	}()
	return s
}

func (s *ProcessDataImp) ExpectReturnedValuesAre() {
	s.T.Helper()
	s.WaitForResponse()

	if s.Returned != nil {
		return
	}

	s.T.Fatalf("expected function to return, but it panicked with: %v", s.Panicked)
}

func (s *ProcessDataImp) ExpectReturnedValuesShould() {
	s.T.Helper()
	s.WaitForResponse()

	if s.Returned != nil {
		return
	}

	s.T.Fatalf("expected function to return, but it panicked with: %v", s.Panicked)
}

func (s *ProcessDataImp) ExpectPanicWith(expected any) {
	s.T.Helper()
	s.WaitForResponse()

	if s.Panicked != nil {
		ok, msg := imptest.MatchValue(s.Panicked, expected)
		if !ok {
			s.T.Fatalf("panic value: %s", msg)
		}
		return
	}

	s.T.Fatalf("expected function to panic, but it returned")
}

type ProcessDataImpResponse struct {
	EventType string // "return" or "panic"
	PanicVal  any
}

func (r *ProcessDataImpResponse) Type() string {
	return r.EventType
}

func (r *ProcessDataImpResponse) AsReturn() []any {
	return nil
}

func (s *ProcessDataImp) GetResponse() *ProcessDataImpResponse {
	s.WaitForResponse()

	if s.Returned != nil {
		return &ProcessDataImpResponse{
			EventType: "ReturnEvent",
		}
	}

	return &ProcessDataImpResponse{
		EventType: "PanicEvent",
		PanicVal:  s.Panicked,
	}
}
