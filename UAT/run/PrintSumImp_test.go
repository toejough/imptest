// Code generated by impgen. DO NOT EDIT.

package run_test

import (
	run "github.com/toejough/imptest/UAT/run"
	"testing"
)

type PrintSumImpReturn struct {
	Val0 int
	Val1 int
	Val2 string
}

type PrintSumImp struct {
	t          testing.TB
	callable   func(a, b int, deps run.IntOps) (int, int, string)
	returnChan chan PrintSumImpReturn
	panicChan  chan any
	returned   *PrintSumImpReturn
	panicked   any
}

func NewPrintSumImp(t testing.TB, callable func(a, b int, deps run.IntOps) (int, int, string)) *PrintSumImp {
	return &PrintSumImp{
		t:          t,
		callable:   callable,
		returnChan: make(chan PrintSumImpReturn, 1),
		panicChan:  make(chan any, 1),
	}
}

func (s *PrintSumImp) Start(a, b int, deps run.IntOps) *PrintSumImp {
	go func() {
		defer func() {
			if r := recover(); r != nil {
				s.panicChan <- r
			}
		}()

		ret0, ret1, ret2 := s.callable(a, b, deps)
		s.returnChan <- PrintSumImpReturn{
			Val0: ret0,
			Val1: ret1,
			Val2: ret2,
		}
	}()
	return s
}

func (s *PrintSumImp) ExpectReturnedValues(v1 int, v2 int, v3 string) {
	s.t.Helper()

	// Check if we already have a return value or panic
	if s.returned != nil {
		if s.returned.Val0 != v1 {
			s.t.Fatalf("expected return value %d to be %v, got %v", 0, v1, s.returned.Val0)
		}
		if s.returned.Val1 != v2 {
			s.t.Fatalf("expected return value %d to be %v, got %v", 1, v2, s.returned.Val1)
		}
		if s.returned.Val2 != v3 {
			s.t.Fatalf("expected return value %d to be %v, got %v", 2, v3, s.returned.Val2)
		}
		return
	}

	if s.panicked != nil {
		s.t.Fatalf("expected function to return, but it panicked with: %v", s.panicked)
	}

	// Wait for either return or panic
	select {
	case ret := <-s.returnChan:
		s.returned = &ret
		if ret.Val0 != v1 {
			s.t.Fatalf("expected return value %d to be %v, got %v", 0, v1, ret.Val0)
		}
		if ret.Val1 != v2 {
			s.t.Fatalf("expected return value %d to be %v, got %v", 1, v2, ret.Val1)
		}
		if ret.Val2 != v3 {
			s.t.Fatalf("expected return value %d to be %v, got %v", 2, v3, ret.Val2)
		}
	case p := <-s.panicChan:
		s.panicked = p
		s.t.Fatalf("expected function to return, but it panicked with: %v", p)
	}
}
