version = '2'

[linters]
default = 'all'
disable = [
	'exhaustruct',    # too noisy for zero value structs
	'forbidigo',      # I print output on purpose sometimes
	'godot',          # has a bug that causes panics on some files
	'godox',          # saving todos till another validation step
	'ireturn',        # I like generic return types
	'nonamedreturns', # I like named returns
	'wsl',            # deprecated
]

[linters.settings]
[linters.settings.depguard]
[linters.settings.depguard.rules]
[linters.settings.depguard.rules.all]
files = ['$all', '!$test']
allow = [
	'$gostd',
	'github.com/alexflint/go-arg',
	'github.com/akedrou/textdiff',
	'github.com/davecgh/go-spew/spew',
	'github.com/dave/dst',
	'github.com/dave/dst/decorator',
	'github.com/dave/dst/dstutil',
	'golang.org/x/tools/go/packages',
	'github.com/toejough/imptest/internal/core',
	'github.com/toejough/imptest/UAT/run',
	'github.com/toejough/imptest/impgen/run',
	'github.com/toejough/go-reorder',
]

[linters.settings.depguard.rules.test]
files = ['$test']
allow = [
	'$gostd',
	'github.com/dave/dst',
	'github.com/dave/dst/decorator',
	'github.com/dave/dst/dstutil',
	'github.com/onsi/gomega',
	'pgregory.net/rapid',
	'github.com/toejough/imptest',
	'github.com/toejough/imptest',
	'github.com/toejough/imptest/UAT/run',
	'github.com/toejough/imptest/impgen/run',
	'github.com/toejough/go-reorder',
	'golang.org/x/tools/go/packages',
]

[linters.settings.nlreturn]
block-size = 2

[linters.settings.unused]
field-writes-are-uses = false
exported-fields-are-used = false
local-variables-are-used = false

[linters.exclusions]
generated = 'lax'
presets = ['comments', 'common-false-positives', 'legacy', 'std-error-handling']
paths = ['third_party$', 'builtin$', 'examples$']

fix = true
[[linters.exclusions.rules]]
# Dynamic errors are acceptable and often clearer in test code/predicates.
# Test code doesn't need to wrap errors or use errors.Is for exact comparisons.
# Global test fixtures and variables are acceptable in tests.
path = "_test.go"
linters = ['err113', 'goconst', 'wrapcheck', 'errorlint', 'gochecknoglobals']

[[linters.exclusions.rules]]
# Tester and TestReporter are intentionally duplicate (v1 and v2 APIs during migration).
path = "internal/core/"
linters = ['iface']

[[linters.exclusions.rules]]
# internal/core/imp_test.go intentionally uses whitebox testing to test internal adapters.
path = "internal/core/imp_test.go"
linters = ['testpackage']

[[linters.exclusions.rules]]
# UAT/variations packages intentionally import other UAT packages to test cross-package scenarios.
path = "UAT/variations/"
linters = ['depguard', 'mnd', 'revive', 'testpackage']

[[linters.exclusions.rules]]
# UAT/core placeholder tests are whitebox tests (same package as code).
path = "UAT/core/.*/placeholder_test.go"
linters = ['testpackage']

[[linters.exclusions.rules]]
# UAT/core/wrapper-function uses 't' for test parameter which is idiomatic.
path = "UAT/core/wrapper-function/callhandle_test.go"
linters = ['varnamelen']

[[linters.exclusions.rules]]
# UAT/core/wrapper-struct uses 't' for test parameter which is idiomatic.
path = "UAT/core/wrapper-struct/callhandle_test.go"
linters = ['varnamelen']

[formatters]
enable = ['gofmt', 'gofumpt', 'goimports']

[formatters.exclusions]
generated = 'lax'
paths = ['third_party$', 'builtin$', 'examples$']
